

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ICD Shopping Cart（CM / PCS）</title>
  <style>
    body{
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      margin:0;
      padding:20px;
      background:#f5f5f7;
      color:#111827;
    }
    .app{
      max-width: 1800px;
      margin: 0 auto;
      background:#fff;
      border-radius:16px;
      box-shadow:0 12px 32px rgba(0,0,0,0.08);
      padding:18px 22px 22px;
    }
    .topbar{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    h1{font-size:18px;margin:0 0 2px 0;}
    .sub{font-size:12px;color:#6b7280;}
    .links{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .linkbtn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid #d1d5db;
      background:#fff;
      color:#111827;
      text-decoration:none;
      font-size:12px;
    }
    .linkbtn:hover{background:#f3f4f6;}
    .badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width:22px;
      height:22px;
      border-radius:999px;
      padding:0 8px;
      background:#0ea5e9;
      color:#fff;
      font-size:12px;
      font-weight:700;
    }

    .panel{
      border:1px solid #e0e4ef;
      background:#fff;
      border-radius:12px;
      padding:12px;
      margin: 12px 0;
    }
    .row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .label{font-size:13px;white-space:nowrap;}
    .input{
      padding:7px 10px;
      border-radius:10px;
      border:1px solid #d1d5db;
      font-size:13px;
      min-width:220px;
      outline:none;
    }
    .input:focus{
      border-color:#007aff;
      box-shadow:0 0 0 2px rgba(0,122,255,0.18);
    }

    .grids{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 10px;
    }
    @media (max-width: 980px){
      .grids{grid-template-columns:1fr;}
    }
    .gridbox{
      border:1px solid #eef2ff;
      background:#fafbff;
      border-radius:12px;
      padding:10px;
    }
    .gridtitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:8px;
    }
    .gridtitle .t{font-size:13px;font-weight:700;}
    .hint{font-size:12px;color:#6b7280;}
    .code-grid{
      display:grid;
      grid-template-columns: repeat(4, minmax(120px, 1fr));
      gap:8px;
    }
    .code-cell{
      display:flex;
      align-items:center;
      gap:6px;
    }
    .code-cell .idx{
      font-size:12px;
      color:#374151;
      width:22px;
      text-align:right;
      flex:0 0 22px;
    }
    .code-cell input{
      width:100%;
      padding:6px 8px;
      border-radius:10px;
      border:1px solid #d1d5db;
      font-size:12px;
      outline:none;
    }
    .code-cell input:focus{
      border-color:#007aff;
      box-shadow:0 0 0 2px rgba(0,122,255,0.18);
    }

    .actions{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .btn{
      padding:7px 12px;
      border-radius:999px;
      border:1px solid #d1d5db;
      background:#fff;
      color:#111827;
      font-size:12px;
      cursor:pointer;
    }
    .btn:hover{background:#f3f4f6;}
    .btn.primary{
      border-color:#93c5fd;
      background:#e7f2ff;
      color:#1d4ed8;
      font-weight:700;
    }
    .btn.primary:hover{background:#dbeafe;}
    .btn.danger{
      border-color:#fecaca;
      background:#fff;
      color:#b91c1c;
      font-weight:700;
    }

    .cartlist{
      display:flex;
      flex-direction:column;
      gap:6px;
      margin-top:10px;
    }

    /* ===== Cart list: CM left / PCS right ===== */
    .added-list-wrapper{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top:10px;
    }
    @media (max-width: 980px){
      .added-list-wrapper{ grid-template-columns: 1fr; }
    }
    .added-col{
      border:1px solid #eef2ff;
      background:#fafbff;
      border-radius:12px;
      padding:10px;
      min-width:0;
    }
    .added-col-title{
      font-size:12px;
      font-weight:700;
      color:#374151;
      margin:0 0 6px 0;
    }
    .added-empty{
      grid-column: 1 / -1;
      font-size:12px;
      color:#6b7280;
      padding:8px 2px;
    }
    .item{
      display:flex;
      gap:10px;
      align-items:baseline;
      padding:6px 8px;
      border-radius:10px;
      border:1px solid #eef2ff;
      background:#f8fafc;
    }
    .item .code{
      color:#0052cc;
      font-weight:800;
      min-width:90px;
      cursor:pointer;
    }
    .item .type{
      font-size:11px;
      color:#6b7280;
      min-width:40px;
    }
    .item .desc{
      flex:1;
      font-size:12px;
      color:#1f2933;
    }
    .item .remove{
      border:none;
      background:transparent;
      cursor:pointer;
      color:#b91c1c;
      font-size:14px;
      line-height:1;
      padding:2px 6px;
    }

    .alert{
      border-radius:12px;
      padding:10px 12px;
      margin:10px 0 0;
      border:1px solid #fecaca;
      background:#fee2e2;
      color:#991b1b;
      font-size:12px;
      display:none;
    }
    .toast{
      position:fixed;
      right:16px;
      bottom:16px;
      background:rgba(17,24,39,0.96);
      color:#fff;
      padding:10px 12px;
      border-radius:12px;
      font-size:12px;
      display:none;
      z-index:99999;
      max-width: 520px;
    }
  
/* ===== Header buttons: cart split ===== */
.linkbtn--cartcounts{
  border-color:#e0e4ef;
  background:#fafbff;
  cursor:default;
}
.linkbtn--disabled{
  pointer-events:none;
  opacity:.55;
  cursor:default;
}
.cart-label{
  font-size:11px;
  color:#374151;
  margin-left:2px;
}
.count-badge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-width:22px;
  height:22px;
  padding:0 7px;
  border-radius:999px;
  background:#0ea5e9;
  color:#fff;
  font-size:12px;
  font-weight:700;
}
</style>
</head>
<body>
  <div class="app">
<div class="topbar" style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:12px;">
  <div style="font-size:18px;font-weight:700;">購物車清單列表</div>
  <div class="links" style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">

      
      <div class="links">
<a class="linkbtn" href="index.html">開啟 CM 搜尋</a>

<a class="linkbtn" href="PCSheader.html">開啟 PCS 搜尋</a>

<span class="linkbtn linkbtn--disabled" aria-current="page">購物車</span>
<span class="linkbtn linkbtn--cartcounts" aria-label="Cart counts">
  <span class="cart-label">CM</span> <span class="count-badge" id="cartCMCount">0</span>
  <span class="cart-label">PCS</span> <span class="count-badge" id="cartPCSCount">0</span>
</span>

      </div></div>

    </div>

    <div class="panel">
      <div class="row">
        <span class="label">病歷號（MRN）</span>
        <input id="mrn" class="input" type="text" autocomplete="off" />
        <span class="label" style="margin-left:10px;">住院號</span>
        <input id="adm" class="input" type="text" autocomplete="off" />
      </div>

      <div class="grids">
        <div class="gridbox">
          <div class="gridtitle">
            <div class="t">CM（1–20）</div>
            <div class="hint">+ 加入時會自動填入下一個空格（若有空位）。</div>
          </div>
          <div id="cmGrid" class="code-grid"></div>
        </div>

        <div class="gridbox">
          <div class="gridtitle">
            <div class="t">PCS（1–20）</div>
            <div class="hint">PCS 7 碼會自動帶入下一個空格（若有空位）。</div>
          </div>
          <div id="pcsGrid" class="code-grid"></div>
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" id="exportCsvBtn">匯出 CSV</button>
        <button class="btn" id="exportJsonBtn">匯出 JSON（備份）</button>
        <button class="btn" id="copyAllBtn">複製全部代碼</button>
        <button class="btn danger" id="clearSlotsBtn">清空格位</button>
      </div>
    </div>

    <div id="capacityAlert" class="alert"></div>

    <div class="panel">
      <div class="row" style="justify-content:space-between;">
        <div style="font-weight:700;font-size:13px;">已加入清單</div>
        <div class="actions" style="margin-top:0;">
          <button class="btn" id="refreshBtn">重新整理</button>
          <button class="btn danger" id="clearCartBtn">清空購物車（含格位）</button>
        </div>
      </div>
      <div id="cartListWrapper" class="added-list-wrapper">
        <div class="added-col">
          <div class="added-col-title">CM</div>
          <div id="cmList" class="cartlist"></div>
        </div>
        <div class="added-col">
          <div class="added-col-title">PCS</div>
          <div id="pcsList" class="cartlist"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

<script>
  // ===== Keys (primary) =====
  const KEYS = {
    items: "icd_cart_items",         // array: {type?:'CM'|'PCS', code, desc, addedAt?}
    mrn:   "icd_cart_mrn",
    adm:   "icd_cart_adm",
    cm:    "icd_cart_cm_slots",      // array length 20
    pcs:   "icd_cart_pcs_slots",     // array length 20
    legacyMeta: "icd_cart_meta"      // {mrn, admNo} for backward compatibility with PCS page
  };
  const SLOT_COUNT = 20;

  const $ = (id) => document.getElementById(id);
  const mrnEl = $("mrn");
  const admEl = $("adm");
  const cmGridEl = $("cmGrid");
  const pcsGridEl = $("pcsGrid");
  const cartListWrapperEl = $("cartListWrapper");
  const cmListEl = $("cmList");
  const pcsListEl = $("pcsList");
  const cmCountEl = document.getElementById("cmCount");
  const pcsCountEl = document.getElementById("pcsCount");
  const cartCMCountEl = document.getElementById("cartCMCount");
  const cartPCSCountEl = document.getElementById("cartPCSCount");
  const capacityAlertEl = document.getElementById("capacityAlert");
const toastEl = $("toast");
  let toastTimer = null;
  function toast(msg){
    toastEl.textContent = msg;
    toastEl.style.display = "block";
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=>{ toastEl.style.display="none"; }, 1800);
  }

  function readJSON(key, fallback){
    try{
      const raw = localStorage.getItem(key);
      if(!raw) return fallback;
      const v = JSON.parse(raw);
      return (v ?? fallback);
    }catch(e){
      return fallback;
    }
  }
  function writeJSON(key, value){
    localStorage.setItem(key, JSON.stringify(value));
  }

  function normalizeSlots(arr){
    const out = new Array(SLOT_COUNT).fill("");
    if(Array.isArray(arr)){
      for(let i=0;i<Math.min(arr.length,SLOT_COUNT);i++){
        out[i] = String(arr[i] ?? "").trim();
      }
    }
    return out;
  }

  function buildGrid(container, prefix){
    container.innerHTML = "";
    const inputs = [];
    for(let i=1;i<=SLOT_COUNT;i++){
      const cell = document.createElement("div");
      cell.className = "code-cell";

      const idx = document.createElement("span");
      idx.className = "idx";
      idx.textContent = String(i);

      const inp = document.createElement("input");
      inp.type = "text";
      inp.autocomplete = "off";
      inp.spellcheck = false;
      inp.id = prefix + i;

      inp.addEventListener("input", persistSlots);

      cell.appendChild(idx);
      cell.appendChild(inp);
      container.appendChild(cell);
      inputs.push(inp);
    }
    return inputs;
  }

  const cmInputs = buildGrid(cmGridEl, "cm");
  const pcsInputs = buildGrid(pcsGridEl, "pcs");

  function persistMeta(){
    try{
      localStorage.setItem(KEYS.mrn, mrnEl.value || "");
      localStorage.setItem(KEYS.adm, admEl.value || "");
      // legacy sync for PCS page
      writeJSON(KEYS.legacyMeta, { mrn: (mrnEl.value||""), admNo: (admEl.value||"") });
    }catch(e){}
  }

  function persistSlots(){
    try{
      writeJSON(KEYS.cm, cmInputs.map(i=>i.value||""));
      writeJSON(KEYS.pcs, pcsInputs.map(i=>i.value||""));
      persistMeta();
    }catch(e){}
  }

  function loadMeta(){
    // Prefer new keys, fallback to legacyMeta (PCS page)
    const mrn = localStorage.getItem(KEYS.mrn) || "";
    const adm = localStorage.getItem(KEYS.adm) || "";
    if(mrn || adm){
      mrnEl.value = mrn;
      admEl.value = adm;
      // ensure legacy is updated too
      persistMeta();
      return;
    }
    const legacy = readJSON(KEYS.legacyMeta, null);
    if(legacy && (legacy.mrn || legacy.admNo)){
      mrnEl.value = legacy.mrn || "";
      admEl.value = legacy.admNo || "";
      persistMeta();
    }
  }

  function loadSlots(){
    const cm = normalizeSlots(readJSON(KEYS.cm, []));
    const pcs = normalizeSlots(readJSON(KEYS.pcs, []));
    cmInputs.forEach((inp, idx)=>{ inp.value = cm[idx] || ""; });
    pcsInputs.forEach((inp, idx)=>{ inp.value = pcs[idx] || ""; });
  }

  function normalizeCode(code){
    return String(code || "").trim();
  }

  function classifyTypeByCode(code){
    const c = normalizeCode(code).toUpperCase();
    if(!c) return "";
    const isPCS = !c.includes(".") && /^[0-9A-HJ-NP-Z]{7}$/.test(c); // PCS excludes I/O
    return isPCS ? "PCS" : "CM";
  }

  
  function pickBestDesc(it, type){
    const t = String(type||"").toUpperCase();
    if(t === "CM"){
      return (it?.tabular || it?.tabularDesc || it?.cmTabularDesc || it?.descTabular || it?.desc || "");
    }
    // PCS or other
    return (it?.desc || it?.pcsDesc || "");
  }

  function formatCartDesc(type, desc){
    const t = String(type||"").toUpperCase();
    let d = String(desc||"").trim();
    if(!d) return "";
    // 若 PCS 仍是「層級路徑」格式：Medical and Surgical / ... / ...
    if(t === "PCS" && d.includes(" / ")){
      const parts = d.split(" / ").map(x=>x.trim()).filter(Boolean);
      // 通常前兩段是 Section / Body System，取後面 5 段並用逗號
      const tail = parts.slice(2);
      if(tail.length){
        d = tail.join(", ");
      }
    }
    return d;
  }

function loadItems(){
    const items = readJSON(KEYS.items, []);
    return Array.isArray(items) ? items : [];
  }
  function saveItems(items){
    writeJSON(KEYS.items, items);
  }

  function countByType(items){
    let cm = 0, pcs = 0;
    (items||[]).forEach(it=>{
      const tRaw = String(it?.type||"");
      const t = tRaw.toUpperCase().replace(/[\[\]\s]/g,"");
      if(t === "CM") cm++;
      else if(t === "PCS") pcs++;
      else{
        // fallback classify
        const guess = classifyTypeByCode(it?.code);
        if(guess === "CM") cm++;
        else if(guess === "PCS") pcs++;
      }
    });
    return {cm, pcs};
  }

  function updateHeaderCountsAndAlert(items){
    const {cm, pcs} = countByType(items);
    if(cmCountEl) cmCountEl.textContent = String(cm);
    if(pcsCountEl) pcsCountEl.textContent = String(pcs);
    if(cartCMCountEl) cartCMCountEl.textContent = String(cm);
    if(cartPCSCountEl) cartPCSCountEl.textContent = String(pcs);

    // Capacity warning (20 slots each)
    const msgs = [];
    if(cm > SLOT_COUNT) msgs.push(`CM 已加入 ${cm} 筆，超過 ${SLOT_COUNT} 格上限（僅前 ${SLOT_COUNT} 格可填入）。`);
    if(pcs > SLOT_COUNT) msgs.push(`PCS 已加入 ${pcs} 筆，超過 ${SLOT_COUNT} 格上限（僅前 ${SLOT_COUNT} 格可填入）。`);
    if(capacityAlertEl){
      if(msgs.length){
        capacityAlertEl.style.display = "block";
        capacityAlertEl.textContent = msgs.join("  ");
      }else{
        capacityAlertEl.style.display = "none";
        capacityAlertEl.textContent = "";
      }
    }
  }


  function removeFromSlotsByCode(code){
    const target = normalizeCode(code).toUpperCase();
    if(!target) return;
    // clear inputs
    for(const inp of cmInputs){
      if(normalizeCode(inp.value).toUpperCase() === target) inp.value = "";
    }
    for(const inp of pcsInputs){
      if(normalizeCode(inp.value).toUpperCase() === target) inp.value = "";
    }
    persistSlots();

    // also clear storage arrays (in case grids aren't in sync for some reason)
    const cm = normalizeSlots(readJSON(KEYS.cm, []));
    const pcs = normalizeSlots(readJSON(KEYS.pcs, []));
    const cmIdx = cm.findIndex(x => String(x||"").toUpperCase() === target);
    if(cmIdx >= 0) cm[cmIdx] = "";
    const pcsIdx = pcs.findIndex(x => String(x||"").toUpperCase() === target);
    if(pcsIdx >= 0) pcs[pcsIdx] = "";
    writeJSON(KEYS.cm, cm);
    writeJSON(KEYS.pcs, pcs);
  }

  function renderCart(){
    const items = loadItems();
    updateHeaderCountsAndAlert(items);
    cmListEl.innerHTML = "";
    pcsListEl.innerHTML = "";
    // remove any previous empty state
    const prevEmpty = cartListWrapperEl.querySelector(".added-empty");
    if(prevEmpty) prevEmpty.remove();
    if(!items.length){
      const empty = document.createElement("div");
      empty.className = "added-empty";
      empty.textContent = "目前尚未加入代碼。請回到 CM / PCS 搜尋頁面，點選 + 加入。";
      cartListWrapperEl.appendChild(empty);
      return;
    }

    // newest last (stable); split into left CM and right PCS (others appended to PCS)
    const display = items.map((it, i)=>({it, i}));
    display.forEach(({it, i})=>{
        const code = normalizeCode(it?.code);
        const type = String(it?.type || classifyTypeByCode(code) || "").toUpperCase();
        const rawDesc = pickBestDesc(it, type);

        const row = document.createElement("div");
        row.className = "item";

        const codeEl = document.createElement("span");
        codeEl.className = "code";
        codeEl.textContent = code || "(empty)";
        codeEl.title = "點擊複製";
        codeEl.addEventListener("click", async ()=>{
          if(!code) return;
          try{
            await navigator.clipboard.writeText(code);
            toast("已複製：" + code);
          }catch(e){
            toast("複製失敗（瀏覽器限制）");
          }
        });

        const typeEl = document.createElement("span");
        typeEl.className = "type";
        typeEl.textContent = type ? ("[" + type + "]") : "";

        const descEl = document.createElement("span");
        descEl.className = "desc";
        descEl.textContent = formatCartDesc(type, rawDesc);

        const rm = document.createElement("button");
        rm.className = "remove";
        rm.textContent = "×";
        rm.title = "移除";
        rm.addEventListener("click", ()=>{
          const current = loadItems();
          const filtered = current.filter((x, idx)=> idx !== i);
          saveItems(filtered);
          if(code) removeFromSlotsByCode(code);
          renderCart();
        });

        row.appendChild(codeEl);
        row.appendChild(typeEl);
        row.appendChild(descEl);
        row.appendChild(rm);
        if(type === "CM") cmListEl.appendChild(row);
        else pcsListEl.appendChild(row);
    });
  }

  function gatherExportPayload(){
    const payload = {
      mrn: mrnEl.value || "",
      admNo: admEl.value || "",
      cm: cmInputs.map(i=>normalizeCode(i.value)),
      pcs: pcsInputs.map(i=>normalizeCode(i.value)),
      items: loadItems()
    };
    return payload;
  }

  function downloadText(filename, content, mime){
    const blob = new Blob([content], {type: mime || "text/plain;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  function toCsvRow(arr){
    return arr.map(v=>{
      const s = String(v ?? "");
      // CSV escaping: wrap in quotes if needed
      if(/[",\n]/.test(s)) return '"' + s.replace(/"/g,'""') + '"';
      return s;
    }).join(",");
  }

  function exportCsv(){
    const p = gatherExportPayload();
    const header = ["MRN","ADM_NO"]
      .concat(Array.from({length:SLOT_COUNT}, (_,i)=>`CM_${i+1}`))
      .concat(Array.from({length:SLOT_COUNT}, (_,i)=>`PCS_${i+1}`));

    const row = [p.mrn, p.admNo]
      .concat(p.cm)
      .concat(p.pcs);

    // Also export the cart list (type/code/desc) as extra lines (so you keep descriptions)
    const lines = [];
    lines.push(toCsvRow(header));
    lines.push(toCsvRow(row));
    lines.push(""); // blank line
    lines.push(toCsvRow(["CART_TYPE","CART_CODE","CART_DESC","ADDED_AT"]));
    (p.items || []).forEach(it=>{
      lines.push(toCsvRow([it?.type||"", it?.code||"", it?.desc||"", it?.addedAt||""]));
    });

    const filename = `ICD_cart_${(p.mrn||"MRN").replace(/\W+/g,"_")}_${(p.admNo||"ADM").replace(/\W+/g,"_")}.csv`;
    downloadText(filename, lines.join("\n"), "text/csv;charset=utf-8");
    toast("已匯出 CSV");
  }

  async function copyAllCodes(){
    const p = gatherExportPayload();
    const codes = []
      .concat(p.cm.filter(Boolean))
      .concat(p.pcs.filter(Boolean));
    const text = codes.join("\n");
    if(!text){
      toast("沒有可複製的代碼");
      return;
    }
    try{
      await navigator.clipboard.writeText(text);
      toast("已複製全部代碼（CM+PCS）");
    }catch(e){
      toast("複製失敗（瀏覽器限制）");
    }
  }

  function exportJson(){
    const p = gatherExportPayload();
    const filename = `ICD_cart_backup_${Date.now()}.json`;
    downloadText(filename, JSON.stringify(p, null, 2), "application/json;charset=utf-8");
    toast("已匯出 JSON");
  }

  // ===== Events =====
  mrnEl.addEventListener("input", persistMeta);
  admEl.addEventListener("input", persistMeta);

  $("refreshBtn").addEventListener("click", ()=>{
    loadMeta();
    loadSlots();
    renderCart();
    toast("已重新整理");
  });

  $("clearSlotsBtn").addEventListener("click", ()=>{
    cmInputs.forEach(i=>i.value="");
    pcsInputs.forEach(i=>i.value="");
    persistSlots();
    toast("已清空格位");
  });

  $("clearCartBtn").addEventListener("click", ()=>{
    if(!confirm("確定要清空購物車清單與格位嗎？")) return;
    saveItems([]);
    cmInputs.forEach(i=>i.value="");
    pcsInputs.forEach(i=>i.value="");
    mrnEl.value = "";
    admEl.value = "";
    persistSlots();
    localStorage.removeItem(KEYS.mrn);
    localStorage.removeItem(KEYS.adm);
    localStorage.removeItem(KEYS.cm);
    localStorage.removeItem(KEYS.pcs);
    localStorage.removeItem(KEYS.legacyMeta);
    renderCart();
    toast("已清空");
  });

  $("exportCsvBtn").addEventListener("click", exportCsv);
  $("exportJsonBtn").addEventListener("click", exportJson);
  $("copyAllBtn").addEventListener("click", copyAllCodes);

  // Initial load
  loadMeta();
  loadSlots();
  renderCart();
</script>
</body>
</html>

